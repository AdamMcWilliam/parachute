let e="Pixel Parachute",t={},a={},o="",n=1920,r=1080,i=.5;function s(e){return Math.floor(Math.random()*Math.floor(e))}window.setupGame=function(s,l,c){e=s,t=l,a=c,o=t.path||"",a.clouds=void 0===a.clouds||null===a.clouds?!a.overlay:a.clouds,i=void 0===a.volume||null===a.volume?0:parseInt(a.volume)/100,n=Math.min(window.innerWidth,1920),r=Math.min(window.innerHeight,1080)},window.WebFontConfig={custom:{families:["Pixeltype"]},active(){Unicorn.Create("unicorn-display",{width:n,height:r,background:"transparent",init:S,update:L,channel:a.channel,username:a.oauth?a.channel:void 0,password:a.oauth,onCommand:d,onChat:h,screenWalls:!1,gravity:{x:0,y:1}}),ComfyJS.onConnected=async(e,o,i)=>{if(i){!function(){if(m=Unicorn.AddBacklay("target","target",184+s(n-368),r-47,{scale:{x:2,y:2}}),m.anchor.set(.5),a.clouds)for(let e=0;e<11;e++){p++;let e=t.clouds[s(t.clouds.length)],o=Unicorn.AddOverlay("cloud_"+p,e,s(n),s(500),{scale:{x:3,y:3}});o.alpha=a.overlay?.5:.9,o.anchor.set(.5),o.speed=.01+.1*Math.random(),o.zIndex=o.speed,U.push(o)}a.hideTilDrop&&(U.forEach(e=>e.visible=!1),m.visible=!1)}();let e=await c();0!==e&&(l=e.session,setInterval(()=>{c()},6e4))}}}},function(){const e=document.createElement("script");e.src=`${"https:"===document.location.protocol?"https":"http"}://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js`,e.type="text/javascript",e.async="true";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();var l="";async function c(){let t=Object.keys(x).length;return fetch("https://api.pixelplush.dev/v1/analytics/heartbeat",{method:"POST",body:JSON.stringify({session:l,game:"parachute",theme:e,channel:a.channel,players:Object.keys(x),count:t})}).then(e=>e.json())}let p=0,y=!0;function d(e,o,n,r,i){if(!r.broadcaster&&!r.mod||"resetparachute"!==o&&"resetdrop"!==o||location.reload(),(r.broadcaster||r.mod)&&"testdrop"===o)for(var l=0;l<50;l++)p++,_("test"+p,"test_"+p,i.userColor||"#ffffff",Object.keys(t.characters)[s(Object.keys(t.characters).length)],t.parachutes[s(t.parachutes.length)]);if("drop"===o){y&&a.hideTilDrop&&(y=!1,U.forEach(e=>e.visible=!0),m.visible=!0);const o=twemoji.parse(n,{assetType:"png"});!i.messageEmotes&&o.length>0?_(i.username,e,i.userColor||"#ffffff",n,t.parachutes[s(t.parachutes.length)],"",o[0].url):_(i.username,e,i.userColor||"#ffffff",n,t.parachutes[s(t.parachutes.length)],i.messageEmotes?Object.keys(i.messageEmotes)[0]:"")}}function h(e,t,a,o,n){}let f,u=null,m=null,x={},b=0,g="",v={},$={},U=[];async function _(e,a,r="#ffffff",l,c,p="",y=""){if(!x[e]){let f=null,m=null,b=null,g=tinycolor(r);if(p){if(!v[p]){v[p]=!0;var d=`https://static-cdn.jtvnw.net/emoticons/v1/${p}/2.0`;return Unicorn.Load(`emote_${p}`,d),void setTimeout(()=>{_(e,a,r,l,c,p,y)},500)}f=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:1.2,y:1.2},animations:{front:{framerate:4/60,frames:[`emote_${p}`],loop:!0}},x:s(n),y:-100-s(50),z:100,radius:36}),f.endImage=`emote_${p}`,f.endScale=1.2}else if(y){if(!$[y])return $[y]=!0,Unicorn.Load(`emoji_${y}`,y),void setTimeout(()=>{_(e,a,r,l,c,p,y)},500);f=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:1,y:1},animations:{front:{framerate:4/60,frames:[`emoji_${y}`],loop:!0}},x:s(n),y:-100-s(50),z:100,radius:36}),f.endImage=`emoji_${y}`,f.endScale=1}else{if(!t.characters[l]){let a={};try{let t=await fetch(`https://api.pixelplush.dev/v1/accounts/twitch/design?username=${e}`).then(e=>e.json());t&&(a=t.style||{})}catch(e){console.log(e)}if(a.character&&a.character.id){if(!t.characters[a.character.id]){t.characters[a.character.id]=a.character.path;for(let e=0;e<10;e++){let n=t.characters[a.character.id];Unicorn.Load(`${a.character.id}_${e}`,`${o}/assets/characters/${a.character.id}/${n}_front/${n}_front${e+1}.png`)}}l=a.character.id}else l=t.playable[Math.floor(t.playable.length*Math.random())];if(a.pet&&a.pet.id&&(t.pets||(t.pets={}),m=a.pet.id.replace("pet_",""),!t.pets[m])){t.pets[m]={path:a.pet.path,minIdle:a.pet.minIdle,maxIdle:a.pet.maxIdle};for(let e=0;e<10;e++){let t=a.pet.path+"_front";Unicorn.Load(t+e,`${o}/assets/pets/${m}/${t}/${t}${e+1}.png`)}}}if(f=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:4/60,frames:[...Array(10).keys()].map(e=>`${l}_${e}`),loop:!0}},x:s(n),y:-100-s(50),z:100,radius:36}),f.endImage=`${l}_0`,f.endScale=3,"boybear"===l||"girlbear"===l){var h=PIXI.utils.string2hex(g.brighten(50).toHexString());f.animations.front.tint=h}if(m){let e={front:[]};for(let a=0;a<10;a++)Object.keys(e).forEach(o=>{e[o].push(t.pets[m].path+"_"+o+a)});b=Unicorn.AddObject("pet_"+name,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:4/60,frames:e.front,loop:!0}},x:-1e3,y:-1e3,z:200,radius:24,isStatic:!0}),b.isSensor=!0}}let U=Unicorn.AddBacklay("para_"+e,c,{scale:{x:3,y:3},x:50,y:0,z:50});U.scale.x=0,U.scale.y=0,U.anchor.set(.5,.9);let S=Unicorn.AddText("name_"+e,a,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:r,lineJoin:"round",stroke:g.getLuminance()<.6?"#ffffff":"#000000",strokeThickness:6});S.anchor.set(.5);let L=Unicorn.AddText(e+"_points","",-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:"#ffd700",lineJoin:"round",stroke:"#000000",strokeThickness:6});L.anchor.set(.5);let M=null;m&&(M=Unicorn.AddBacklay("petpara_"+e,c,{scale:{x:1,y:1},x:50,y:0,z:150}),M.scale.x=0,M.scale.y=0,M.anchor.set(.5,.9)),f.restitution=1,f.friction=0,f.frictionStatic=0,f.frictionAir=0,f.torque=-5+s(10),f.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity("player_"+e,s(24)-12,0),x[e]={parachute:U,player:f,pet:b,petPara:M,petType:m,petOffset:200*Math.random()-100,label:S,scoreLabel:L},Unicorn.PlaySound("sfx-parachute-drop",{volume:i}),u&&clearTimeout(u),u=setTimeout(()=>{location.reload()},9e4)}}function S(){if(PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,Unicorn.Load("map",`${o}/assets/${t.bg}.png`),!a.overlay){var e=Unicorn.AddBacklay("map","map",0,r-1080);e.scale.x=3,e.scale.y=3}Unicorn.Load("target",`${o}/assets/${t.target}.png`),Unicorn.Load("star",`${o}/assets/icons/star.png`),f=Unicorn.AddOverlay("star","star",-1e3,-1e3,{scale:{x:3,y:3}}),f.anchor.set(.5),t.parachutes.forEach(e=>Unicorn.Load(e,`${o}/assets/${e}.png`)),Object.keys(t.characters).forEach(e=>{for(let a=0;a<10;a++){let n=t.characters[e];Unicorn.Load(`${e}_${a}`,`${o}/assets/characters/${e}/${n}_front/${n}_front${a+1}.png`)}}),t.clouds.forEach(e=>Unicorn.Load(e,`${o}/assets/${e}.png`)),Unicorn.Load("sfx-parachute-drop",`${o}/assets/${t.drop_sound}`),Unicorn.Load("sfx-parachute-flap",`${o}/assets/${t.parachute_sound}`),Unicorn.AddObject("WallLeft",{type:"rectangle",x:-200,y:0,width:400,height:2*r,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("WallRight",{type:"rectangle",x:n+200,y:0,width:400,height:2*r,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("WallBottom",{type:"rectangle",x:.5*n,y:r+100,width:n,height:200,isStatic:!0}).sprite.visible=!1,Matter.Events.on(physics,"beforeUpdate",(function(e){for(var t in x)x[t].player.position.y<.5*-r?Matter.Body.setVelocity(x[t].player,{x:x[t].player.velocity.x,y:Math.min(x[t].player.velocity.y,10)}):x[t].player.position.y>300&&Matter.Body.setVelocity(x[t].player,{x:x[t].player.velocity.x,y:Math.min(x[t].player.velocity.y,.5)})}))}function L(e,t){for(var o in x)if(x[o].isLanded){let e=o===g?1:.3;x[o].end.alpha=x[o].label.alpha=e,x[o].pet&&(x[o].petEnd.alpha=e),x[o].scoreLabel.tint=x[o].label.tint=o===g?16777215:3355443,o===g?(x[o].end.zIndex=x[o].scoreLabel.zIndex=x[o].label.zIndex=9e3,x[o].pet&&(x[o].pet.zIndex=9001),x[o].label.position.x=x[o].player.position.x,x[o].label.position.y=x[o].player.position.y-80,x[o].scoreLabel.position.x=x[o].label.position.x+15,x[o].scoreLabel.position.y=x[o].label.position.y-30,x[o].label.style.fontSize=46,x[o].scoreLabel.style.fontSize=46,f.x=x[o].scoreLabel.x-x[o].scoreLabel.width/2-15,f.y=x[o].scoreLabel.y-5):(x[o].label.position.x=x[o].player.position.x,x[o].label.position.y=x[o].player.position.y-60,x[o].scoreLabel.position.y=x[o].label.position.y-30,x[o].scoreLabel.alpha=0,x[o].label.style.fontSize=40,x[o].scoreLabel.style.fontSize=40)}else{if(x[o].pet&&(x[o].pet.position.x=Math.max(20,Math.min(n-20,x[o].player.position.x+x[o].petOffset)),x[o].pet.position.y=x[o].player.position.y+20),x[o].player.position.y>r-46-50){x[o].isLanded=!0,x[o].parachute.scale.x=x[o].parachute.scale.y=0,x[o].pet&&(x[o].petPara.scale.x=x[o].petPara.scale.y=0);let e=Unicorn.AddBacklay("end_"+o,x[o].player.endImage,x[o].player.position.x,x[o].player.position.y,{scale:{x:x[o].player.endScale,y:x[o].player.endScale}});if(x[o].player.animations&&(e.tint=x[o].player.animations.front.tint),e.anchor.set(.5),x[o].player.isStatic=!0,x[o].score=100*Math.max(0,184-Math.abs(m.position.x-x[o].player.position.x))/184,e.alpha=x[o].score>0?1:.3,x[o].end=e,x[o].pet){let e=Unicorn.AddBacklay("petend_"+o,`${x[o].petType}_front0`,x[o].pet.position.x,x[o].pet.position.y,{scale:{x:3,y:3}});x[o].pet.animations&&(e.tint=x[o].pet.animations.front.tint),e.anchor.set(.5),x[o].pet.isStatic=!0,e.alpha=x[o].score>0?1:.3,x[o].petEnd=e}if(x[o].score>0&&(x[o].scoreLabel.x=x[o].label.position.x,x[o].scoreLabel.y=x[o].label.position.y-30,x[o].scoreLabel.text=x[o].score.toFixed(2),a.messageFormat)){let e=a.messageFormat.replace("USERNAME",o).replace("POINTS",x[o].score.toFixed(2));setTimeout(()=>{ComfyJS.Say(e)},5e3)}x[o].score>b&&(b=x[o].score,g=o),x[o].label.alpha=x[o].score>0?1:.3,Unicorn.RemoveObject(x[o].player.label),Unicorn.RemoveBacklay("para_"+o),x[o].pet&&(Unicorn.RemoveObject(x[o].pet.label),Unicorn.RemoveBacklay("petpara_"+o))}else if(x[o].player.position.y>300){let t=Math.min(3,Math.max(0,.3*(x[o].player.position.y-300)));x[o].parachute.scale.x<=0&&t>0&&Unicorn.PlaySound("sfx-parachute-flap",{volume:i}),x[o].parachute.scale.x=x[o].parachute.scale.y=t,x[o].parachute.rotation=Math.sin(x[o].player.rotationOffset+e/1e3)*Math.PI/16,x[o].player.angle=Math.sin(x[o].player.rotationOffset+e/1e3)*Math.PI/16,x[o].parachute.position.x=x[o].player.position.x,x[o].parachute.position.y=x[o].player.position.y-10,x[o].pet&&(x[o].petPara.scale.x=x[o].petPara.scale.y=t/2,x[o].pet.angle=x[o].player.angle,x[o].petPara.position.x=x[o].pet.position.x,x[o].petPara.position.y=x[o].pet.position.y-10)}else x[o].player.position.y<.5*-r||(x[o].parachute.scale.x=x[o].parachute.scale.y=0,x[o].pet&&(x[o].petPara.scale.x=x[o].petPara.scale.y=0));x[o].label.position.x=x[o].player.position.x,x[o].label.position.y=x[o].player.position.y-60}U.forEach((e,a)=>{e.x-=t*e.speed,e.x+e.width/2<=0&&(e.x=n+e.width/2,e.y=s(500),e.speed=.01+.1*Math.random(),e.zIndex=e.speed)})}