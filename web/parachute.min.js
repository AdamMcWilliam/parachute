let e="Pixel Parachute",a={},t={},o="",r=1920,n=1080,i=.5;function s(e){return Math.floor(Math.random()*Math.floor(e))}function l(){let a=Object.keys(m).length;fetch(`https://api.instafluff.tv:8082/report?game=${e}&channel=${t.channel}&players=${a}&persist=true`).then(e=>e.json()).then(e=>{0===e.status&&console.log("Error:",e.message)})}window.setupGame=function(s,l,c){e=s,a=l,t=c,o=a.path||"",t.clouds=void 0===t.clouds||null===t.clouds?!t.overlay:t.clouds,i=void 0===t.volume||null===t.volume?0:parseInt(t.volume)/100,r=Math.min(window.innerWidth,1920),n=Math.min(window.innerHeight,1080)},window.WebFontConfig={custom:{families:["Pixeltype"]},active(){Unicorn.Create("unicorn-display",{width:r,height:n,background:"transparent",init:L,update:S,channel:t.channel,username:t.oauth?t.channel:void 0,password:t.oauth,onCommand:d,onChat:h,screenWalls:!1,gravity:{x:0,y:1}}),ComfyJS.onConnected=(e,o,i)=>{i&&(function(){if(u=Unicorn.AddBacklay("target","target",184+s(r-368),n-47,{scale:{x:2,y:2}}),u.anchor.set(.5),t.clouds)for(let e=0;e<11;e++){c++;let e=a.clouds[s(a.clouds.length)],o=Unicorn.AddOverlay("cloud_"+c,e,s(r),s(500),{scale:{x:3,y:3}});o.alpha=t.overlay?.5:.9,o.anchor.set(.5),o.speed=.01+.1*Math.random(),o.zIndex=o.speed,v.push(o)}t.hideTilDrop&&(v.forEach(e=>e.visible=!1),u.visible=!1)}(),setInterval(()=>{l()},6e4),l())}}},function(){const e=document.createElement("script");e.src=`${"https:"===document.location.protocol?"https":"http"}://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js`,e.type="text/javascript",e.async="true";const a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(e,a)}();let c=0,p=!0;function d(e,o,r,n,i){if(!n.broadcaster&&!n.mod||"resetparachute"!==o&&"resetdrop"!==o||location.reload(),(n.broadcaster||n.mod)&&"testdrop"===o)for(var l=0;l<50;l++)c++,U("test"+c,"test_"+c,i.userColor||"#ffffff",Object.keys(a.characters)[s(Object.keys(a.characters).length)],a.parachutes[s(a.parachutes.length)]);if("drop"===o){p&&t.hideTilDrop&&(p=!1,v.forEach(e=>e.visible=!0),u.visible=!0);const o=twemoji.parse(r,{assetType:"png"});!i.messageEmotes&&o.length>0?U(i.username,e,i.userColor||"#ffffff",r,a.parachutes[s(a.parachutes.length)],"",o[0].url):U(i.username,e,i.userColor||"#ffffff",r,a.parachutes[s(a.parachutes.length)],i.messageEmotes?Object.keys(i.messageEmotes)[0]:"")}}function h(e,a,t,o,r){}let y,f=null,u=null,m={},b=0,x="",g={},$={},v=[];async function U(e,t,n="#ffffff",l,c,p="",d=""){if(!m[e]){let u=null,b=tinycolor(n);if(p){if(!g[p]){g[p]=!0;var h=`https://static-cdn.jtvnw.net/emoticons/v1/${p}/2.0`;return Unicorn.Load(`emote_${p}`,h),void setTimeout(()=>{U(e,t,n,l,c,p,d)},500)}u=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:1.2,y:1.2},animations:{front:{framerate:4/60,frames:[`emote_${p}`],loop:!0}},x:s(r),y:-100-s(50),z:100,radius:36}),u.endImage=`emote_${p}`,u.endScale=1.2}else if(d){if(!$[d])return $[d]=!0,Unicorn.Load(`emoji_${d}`,d),void setTimeout(()=>{U(e,t,n,l,c,p,d)},500);u=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:1,y:1},animations:{front:{framerate:4/60,frames:[`emoji_${d}`],loop:!0}},x:s(r),y:-100-s(50),z:100,radius:36}),u.endImage=`emoji_${d}`,u.endScale=1}else{if(!a.characters[l]){let t={};try{let a=await fetch(`https://blockparty.instafluff.tv:3000/v1/accounts/twitch/design?username=${e}`).then(e=>e.json());a&&(t=a.style||{})}catch(e){console.log(e)}if(t.character){if(!a.characters[t.character.id]){a.characters[t.character.id]=t.character.path;for(let e=0;e<10;e++){let r=a.characters[t.character.id];Unicorn.Load(`${t.character.id}_${e}`,`${o}/assets/characters/${t.character.id}/${r}_front/${r}_front${e+1}.png`)}}l=t.character.id}else l=a.playable[Math.floor(a.playable.length*Math.random())]}if(u=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:4/60,frames:[...Array(10).keys()].map(e=>`${l}_${e}`),loop:!0}},x:s(r),y:-100-s(50),z:100,radius:36}),u.endImage=`${l}_0`,u.endScale=3,"boybear"===l||"girlbear"===l){var y=PIXI.utils.string2hex(b.brighten(50).toHexString());u.animations.front.tint=y}}let x=Unicorn.AddBacklay("para_"+e,c,{scale:{x:3,y:3},x:50,y:0,z:50});x.scale.x=0,x.scale.y=0,x.anchor.set(.5,.9);let v=Unicorn.AddText("name_"+e,t,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:n,lineJoin:"round",stroke:b.getLuminance()<.6?"#ffffff":"#000000",strokeThickness:6});v.anchor.set(.5);let L=Unicorn.AddText(e+"_points","",-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:"#ffd700",lineJoin:"round",stroke:"#000000",strokeThickness:6});L.anchor.set(.5),u.restitution=1,u.friction=0,u.frictionStatic=0,u.frictionAir=0,u.torque=-5+s(10),u.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity("player_"+e,s(24)-12,0),m[e]={parachute:x,player:u,label:v,scoreLabel:L},Unicorn.PlaySound("sfx-parachute-drop",{volume:i}),f&&clearTimeout(f),f=setTimeout(()=>{location.reload()},9e4)}}function L(){if(PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,Unicorn.Load("map",`${o}/assets/${a.bg}.png`),!t.overlay){var e=Unicorn.AddBacklay("map","map",0,n-1080);e.scale.x=3,e.scale.y=3}Unicorn.Load("target",`${o}/assets/${a.target}.png`),Unicorn.Load("star",`${o}/assets/icons/star.png`),y=Unicorn.AddOverlay("star","star",-1e3,-1e3,{scale:{x:3,y:3}}),y.anchor.set(.5),a.parachutes.forEach(e=>Unicorn.Load(e,`${o}/assets/${e}.png`)),Object.keys(a.characters).forEach(e=>{for(let t=0;t<10;t++){let r=a.characters[e];Unicorn.Load(`${e}_${t}`,`${o}/assets/characters/${e}/${r}_front/${r}_front${t+1}.png`)}}),a.clouds.forEach(e=>Unicorn.Load(e,`${o}/assets/${e}.png`)),Unicorn.Load("sfx-parachute-drop",`${o}/assets/${a.drop_sound}`),Unicorn.Load("sfx-parachute-flap",`${o}/assets/${a.parachute_sound}`),Unicorn.AddObject("WallLeft",{type:"rectangle",x:-200,y:0,width:400,height:2*n,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("WallRight",{type:"rectangle",x:r+200,y:0,width:400,height:2*n,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("WallBottom",{type:"rectangle",x:.5*r,y:n+100,width:r,height:200,isStatic:!0}).sprite.visible=!1}function S(e,a){for(var o in m)if(m[o].isLanded){let e=o===x?1:.3;m[o].end.alpha=m[o].label.alpha=e,m[o].scoreLabel.tint=m[o].label.tint=o===x?16777215:3355443,o===x?(m[o].end.zIndex=m[o].scoreLabel.zIndex=m[o].label.zIndex=9e3,m[o].label.position.x=m[o].player.position.x,m[o].label.position.y=m[o].player.position.y-80,m[o].scoreLabel.position.x=m[o].label.position.x+15,m[o].scoreLabel.position.y=m[o].label.position.y-30,m[o].label.style.fontSize=46,m[o].scoreLabel.style.fontSize=46,y.x=m[o].scoreLabel.x-m[o].scoreLabel.width/2-15,y.y=m[o].scoreLabel.y-5):(m[o].label.position.x=m[o].player.position.x,m[o].label.position.y=m[o].player.position.y-60,m[o].scoreLabel.position.y=m[o].label.position.y-30,m[o].scoreLabel.alpha=0,m[o].label.style.fontSize=40,m[o].scoreLabel.style.fontSize=40)}else{if(m[o].player.position.y>n-46-50){m[o].isLanded=!0,m[o].parachute.scale.x=m[o].parachute.scale.y=0;let e=Unicorn.AddBacklay("end_"+o,m[o].player.endImage,m[o].player.position.x,m[o].player.position.y,{scale:{x:m[o].player.endScale,y:m[o].player.endScale}});if(m[o].player.animations&&(e.tint=m[o].player.animations.front.tint),e.anchor.set(.5),m[o].player.isStatic=!0,m[o].score=100*Math.max(0,184-Math.abs(u.position.x-m[o].player.position.x))/184,e.alpha=m[o].score>0?1:.3,m[o].end=e,m[o].score>0&&(m[o].scoreLabel.x=m[o].label.position.x,m[o].scoreLabel.y=m[o].label.position.y-30,m[o].scoreLabel.text=m[o].score.toFixed(2),t.messageFormat)){let e=t.messageFormat.replace("USERNAME",o).replace("POINTS",m[o].score.toFixed(2));setTimeout(()=>{ComfyJS.Say(e)},5e3)}m[o].score>b&&(b=m[o].score,x=o),m[o].label.alpha=m[o].score>0?1:.3,Unicorn.RemoveObject(m[o].player.label),Unicorn.RemoveBacklay("para_"+o)}else if(m[o].player.position.y>300){Unicorn.SetVelocity(m[o].player.label,m[o].player.velocity.x,.5);let a=Math.min(3,Math.max(0,.3*(m[o].player.position.y-300)));m[o].parachute.scale.x<=0&&a>0&&Unicorn.PlaySound("sfx-parachute-flap",{volume:i}),m[o].parachute.scale.x=m[o].parachute.scale.y=a,m[o].parachute.rotation=Math.sin(m[o].player.rotationOffset+e/1e3)*Math.PI/16,m[o].player.angle=Math.sin(m[o].player.rotationOffset+e/1e3)*Math.PI/16,m[o].parachute.position.x=m[o].player.position.x,m[o].parachute.position.y=m[o].player.position.y-10}else m[o].player.position.y<.5*-n?Unicorn.SetVelocity(m[o].player.label,m[o].player.velocity.x,10):m[o].parachute.scale.x=m[o].parachute.scale.y=0;m[o].label.position.x=m[o].player.position.x,m[o].label.position.y=m[o].player.position.y-60}v.forEach((e,t)=>{e.x-=a*e.speed,e.x+e.width/2<=0&&(e.x=r+e.width/2,e.y=s(500),e.speed=.01+.1*Math.random(),e.zIndex=e.speed)})}