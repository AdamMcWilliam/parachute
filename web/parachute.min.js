let e="Pixel Parachute",t={},a={},o="",n=1920,i=1080;function r(e){return Math.floor(Math.random()*Math.floor(e))}function l(){let t=Object.keys(m).length;fetch(`https://api.instafluff.tv:8082/report?game=${e}&channel=${a.channel}&players=${t}&persist=true`).then(e=>e.json()).then(e=>{0===e.status&&console.log("Error:",e.message)})}window.setupGame=function(r,l,s){e=r,t=l,a=s,o=t.path||"",a.clouds=void 0===a.clouds||null===a.clouds?!a.overlay:a.clouds,n=Math.min(window.innerWidth,1920),i=Math.min(window.innerHeight,1080)},window.WebFontConfig={custom:{families:["Pixeltype"]},active(){Unicorn.Create("unicorn-display",{width:n,height:i,background:"transparent",init:L,update:S,channel:a.channel,username:a.oauth?a.channel:void 0,password:a.oauth,onCommand:p,onChat:y,screenWalls:!1,gravity:{x:0,y:1}}),ComfyJS.onConnected=(e,o,c)=>{c&&(function(){if(h=Unicorn.AddBacklay("target","target",184+r(n-368),i-47,{scale:{x:2,y:2}}),h.anchor.set(.5),a.clouds)for(let e=0;e<11;e++){s++;let e=t.clouds[r(t.clouds.length)],o=Unicorn.AddOverlay("cloud_"+s,e,r(n),r(500),{scale:{x:3,y:3}});o.alpha=a.overlay?.5:.9,o.anchor.set(.5),o.speed=.01+.1*Math.random(),o.zIndex=o.speed,$.push(o)}a.hideTilDrop&&($.forEach(e=>e.visible=!1),h.visible=!1)}(),setInterval(()=>{l()},6e4),l())}}},function(){const e=document.createElement("script");e.src=`${"https:"===document.location.protocol?"https":"http"}://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js`,e.type="text/javascript",e.async="true";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();let s=0,c=!0;function p(e,o,n,i,l){if(!i.broadcaster&&!i.mod||"resetparachute"!==o&&"resetdrop"!==o||location.reload(),(i.broadcaster||i.mod)&&"testdrop"===o)for(var p=0;p<50;p++)s++,v("test"+s,"test_"+s,l.userColor||"#ffffff",Object.keys(t.characters)[r(Object.keys(t.characters).length)],t.parachutes[r(t.parachutes.length)]);if("drop"===o){c&&a.hideTilDrop&&(c=!1,$.forEach(e=>e.visible=!0),h.visible=!0);const o=twemoji.parse(n,{assetType:"png"});!l.messageEmotes&&o.length>0?v(e,e,l.userColor||"#ffffff",n,t.parachutes[r(t.parachutes.length)],"",o[0].url):v(e,e,l.userColor||"#ffffff",n,t.parachutes[r(t.parachutes.length)],l.messageEmotes?Object.keys(l.messageEmotes)[0]:"")}}function y(e,t,a,o,n){}let d,f=null,h=null,m={},u=0,b="",x={},g={},$=[];function v(e,a,o="#ffffff",i,l,s="",c=""){if(!m[e]){let d=null,h=tinycolor(o);if(s){if(!x[s]){x[s]=!0;var p=`https://static-cdn.jtvnw.net/emoticons/v1/${s}/2.0`;return Unicorn.Load(`emote_${s}`,p),void setTimeout(()=>{v(e,a,o,i,l,s,c)},500)}d=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:1.2,y:1.2},animations:{front:{framerate:4/60,frames:[`emote_${s}`],loop:!0}},x:r(n),y:-100-r(50),z:100,radius:36}),d.endImage=`emote_${s}`,d.endScale=1.2}else if(c){if(!g[c])return g[c]=!0,Unicorn.Load(`emoji_${c}`,c),void setTimeout(()=>{v(e,a,o,i,l,s,c)},500);d=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:1,y:1},animations:{front:{framerate:4/60,frames:[`emoji_${c}`],loop:!0}},x:r(n),y:-100-r(50),z:100,radius:36}),d.endImage=`emoji_${c}`,d.endScale=1}else if(t.characters[i]||(i=t.playable[Math.floor(t.playable.length*Math.random())]),d=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:4/60,frames:[...Array(10).keys()].map(e=>`${i}_${e}`),loop:!0}},x:r(n),y:-100-r(50),z:100,radius:36}),d.endImage=`${i}_0`,d.endScale=3,"boybear"===i||"girlbear"===i){var y=PIXI.utils.string2hex(h.brighten(50).toHexString());d.animations.front.tint=y}let u=Unicorn.AddBacklay("para_"+e,l,{scale:{x:3,y:3},x:50,y:0,z:50});u.scale.x=0,u.scale.y=0,u.anchor.set(.5,.9);let b=Unicorn.AddText("name_"+e,a,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:o,lineJoin:"round",stroke:h.getLuminance()<.6?"#ffffff":"#000000",strokeThickness:6});b.anchor.set(.5);let $=Unicorn.AddText(e+"_points","",-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:"#ffd700",lineJoin:"round",stroke:"#000000",strokeThickness:6});$.anchor.set(.5),d.restitution=1,d.friction=0,d.frictionStatic=0,d.frictionAir=0,d.torque=-5+r(10),d.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity("player_"+e,r(24)-12,0),m[e]={parachute:u,player:d,label:b,scoreLabel:$},f&&clearTimeout(f),f=setTimeout(()=>{location.reload()},9e4)}}function L(){if(PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,Unicorn.Load("map",`${o}/assets/${t.bg}.png`),!a.overlay){var e=Unicorn.AddBacklay("map","map",0,i-1080);e.scale.x=3,e.scale.y=3}Unicorn.Load("target",`${o}/assets/${t.target}.png`),Unicorn.Load("star",`${o}/assets/icons/star.png`),d=Unicorn.AddOverlay("star","star",-1e3,-1e3,{scale:{x:3,y:3}}),d.anchor.set(.5),t.parachutes.forEach(e=>Unicorn.Load(e,`${o}/assets/${e}.png`)),Object.keys(t.characters).forEach(e=>{for(let a=0;a<10;a++){let n=t.characters[e];Unicorn.Load(`${e}_${a}`,`${o}/assets/characters/${e}/${n}_front/${n}_front${a+1}.png`)}}),t.clouds.forEach(e=>Unicorn.Load(e,`${o}/assets/${e}.png`)),Unicorn.AddObject("WallLeft",{type:"rectangle",x:-200,y:0,width:400,height:2*i,isStatic:!0}),Unicorn.AddObject("WallRight",{type:"rectangle",x:n+200,y:0,width:400,height:2*i,isStatic:!0}),Unicorn.AddObject("WallBottom",{type:"rectangle",x:.5*n,y:i+100,width:n,height:200,isStatic:!0})}function S(e,t){for(var o in m)if(m[o].isLanded){let e=o===b?1:.3;m[o].end.alpha=m[o].label.alpha=e,m[o].scoreLabel.tint=m[o].label.tint=o===b?16777215:3355443,o===b?(m[o].end.zIndex=m[o].scoreLabel.zIndex=m[o].label.zIndex=9e3,m[o].label.position.x=m[o].player.position.x,m[o].label.position.y=m[o].player.position.y-80,m[o].scoreLabel.position.x=m[o].label.position.x+15,m[o].scoreLabel.position.y=m[o].label.position.y-30,m[o].label.style.fontSize=46,m[o].scoreLabel.style.fontSize=46,d.x=m[o].scoreLabel.x-m[o].scoreLabel.width/2-15,d.y=m[o].scoreLabel.y-5):(m[o].label.position.x=m[o].player.position.x,m[o].label.position.y=m[o].player.position.y-60,m[o].scoreLabel.position.y=m[o].label.position.y-30,m[o].scoreLabel.alpha=0,m[o].label.style.fontSize=40,m[o].scoreLabel.style.fontSize=40)}else{if(m[o].player.position.y>i-46-50){m[o].isLanded=!0,m[o].parachute.scale.x=m[o].parachute.scale.y=0;let e=Unicorn.AddBacklay("end_"+o,m[o].player.endImage,m[o].player.position.x,m[o].player.position.y,{scale:{x:m[o].player.endScale,y:m[o].player.endScale}});if(m[o].player.animations&&(e.tint=m[o].player.animations.front.tint),e.anchor.set(.5),m[o].player.isStatic=!0,m[o].score=100*Math.max(0,184-Math.abs(h.position.x-m[o].player.position.x))/184,e.alpha=m[o].score>0?1:.3,m[o].end=e,m[o].score>0&&(m[o].scoreLabel.x=m[o].label.position.x,m[o].scoreLabel.y=m[o].label.position.y-30,m[o].scoreLabel.text=m[o].score.toFixed(2),a.messageFormat)){let e=a.messageFormat.replace("USERNAME",o).replace("POINTS",m[o].score.toFixed(2));setTimeout(()=>{ComfyJS.Say(e)},5e3)}m[o].score>u&&(u=m[o].score,b=o),m[o].label.alpha=m[o].score>0?1:.3,Unicorn.RemoveObject(m[o].player.label),Unicorn.RemoveBacklay("para_"+o)}else if(m[o].player.position.y>300){Unicorn.SetVelocity(m[o].player.label,m[o].player.velocity.x,.5);let t=Math.min(3,Math.max(0,.3*(m[o].player.position.y-300)));m[o].parachute.scale.x=m[o].parachute.scale.y=t,m[o].parachute.rotation=Math.sin(m[o].player.rotationOffset+e/1e3)*Math.PI/16,m[o].player.angle=Math.sin(m[o].player.rotationOffset+e/1e3)*Math.PI/16,m[o].parachute.position.x=m[o].player.position.x,m[o].parachute.position.y=m[o].player.position.y-10}else m[o].player.position.y<.5*-i?Unicorn.SetVelocity(m[o].player.label,m[o].player.velocity.x,10):m[o].parachute.scale.x=m[o].parachute.scale.y=0;m[o].label.position.x=m[o].player.position.x,m[o].label.position.y=m[o].player.position.y-60}$.forEach((e,a)=>{e.x-=t*e.speed,e.x+e.width/2<=0&&(e.x=n+e.width/2,e.y=r(500),e.speed=.01+.1*Math.random(),e.zIndex=e.speed)})}