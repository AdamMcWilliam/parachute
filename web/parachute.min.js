const e="https://api.pixelplush.dev/v1";let t="Pixel Parachute",a={},o={},r="",n=1920,s=1080,i=.5;function l(e){return Math.floor(Math.random()*Math.floor(e))}window.setupGame=function(e,l,c){t=e,a=l,o=c,r=a.path||"",o.clouds=void 0===o.clouds||null===o.clouds?!o.overlay:o.clouds,i=void 0===o.volume||null===o.volume?0:parseInt(o.volume)/100,n=Math.min(window.innerWidth,1920),s=Math.min(window.innerHeight,1080)},window.WebFontConfig={custom:{families:["Pixeltype"]},active(){!async function(){if(document.hidden)return void document.addEventListener("visibilitychange",()=>{location.reload()},!1);try{const e=(await fetch(`${r}/assets/shamelist.txt`).then(e=>e.text())).split(",").map(e=>e.trim().toLowerCase());o.channel&&e&&e.includes(o.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),p=!1)}catch(e){console.log(e)}Unicorn.Create("unicorn-display",{width:n,height:s,background:"transparent",init:D,update:B,channel:o.channel,username:o.oauth?o.channel:void 0,password:o.oauth,onCommand:u,onChat:m,screenWalls:!1,gravity:{x:0,y:1}}),ComfyJS.onCheer=g,ComfyJS.onConnected=async(e,t,r)=>{if(r){!function(){if($=a.target_width||368,v=$/2+l(n-$),S=s-47+(a.target_offset||0),Array.isArray(a.target)){I=0,_=[];for(let e=0;e<a.target.length;e++){let t=Unicorn.AddBacklay("target"+e,"target"+e,v,S,{scale:{x:2,y:2}});t.zIndex=10,t.anchor.set(.5),t.visible=!1,_.push(t)}_[I].visible=!0,o.hideTilDrop||setInterval(()=>{_[I].visible=!1,I=(I+1)%_.length,_[I].visible=!0},60)}else _=Unicorn.AddBacklay("target","target",v,S,{scale:{x:2,y:2}}),_.zIndex=10,_.anchor.set(.5);a.target_front&&(U=Unicorn.AddOverlay("target_front","target_front",v,S,{scale:{x:2,y:2}}),U.anchor.set(.5));if(o.clouds)for(let e=0;e<11;e++){y++;let e=a.clouds[l(a.clouds.length)],t=Unicorn.AddOverlay("cloud_"+y,e,l(n),l(500),{scale:{x:3,y:3}});t.alpha=o.overlay?.5:.9,t.anchor.set(.5),t.speed=.01+.1*Math.random(),t.zIndex=t.speed,O.push(t)}o.hideTilDrop&&(O.forEach(e=>e.visible=!1),Array.isArray(a.target)?_.forEach(e=>{e.visible=!1}):_.visible=!1,U.visible=!1)}();let e=await d();0!==e&&(c=e.session,setInterval(()=>{d()},6e4))}}}()}},function(){const e=document.createElement("script");e.src=`${"https:"===document.location.protocol?"https":"http"}://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js`,e.type="text/javascript",e.async="true";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();var c="",p=!0;async function d(){let a=Object.keys(w).length;return fetch(`${e}/analytics/heartbeat`,{method:"POST",body:JSON.stringify({session:c,game:"parachute",theme:t,channel:o.channel,players:Object.keys(w),count:a})}).then(e=>e.json())}async function h(a,r,n,s){return o.oauth?fetch(`${e}/scores/add`,{method:"POST",body:JSON.stringify({token:o.oauth.replace("oauth:",""),channel:o.channel,game:"parachute",theme:t,user:a,score:r,userId:n,username:s})}).then(e=>e.json()):{}}let y=0,f=!0;async function u(t,r,n,s,i){if(document.hidden)return;if(!s.broadcaster&&!s.mod||"resetparachute"!==r&&"resetdrop"!==r||location.reload(),(s.broadcaster||s.mod)&&"testdrop"===r)for(var c=0;c<50;c++)y++,z("test"+y,"test_"+y,i.userColor||"#ffffff",Object.keys(a.characters)[l(Object.keys(a.characters).length)],a.parachutes[l(a.parachutes.length)],"","",i);if((s.broadcaster||s.mod)&&"droplet"===r){let e=parseInt(n||Math.pow(10,l(6)));for(let t=0;t<5;t++)C(e)}if(("drophigh"===r||"drophighscore"===r||"dropbest"===r)&&o.oauth){let t=await async function(){if(o.oauth){const t=new Date;t.setDate(t.getDate()-1);const a=t.toISOString().split("T")[0];return(await fetch(`${e}/scores/high?channel=${o.channel}&game=parachute&date=${a}`,{method:"GET"}).then(e=>e.json()))[0]}return null}();t&&t.score&&ComfyJS.Say(`/me The highest score in the past 24 hours is ${t.score} by ${t.user}`)}if(("droplow"===r||"droplowscore"===r||"dropworst"===r)&&o.oauth){let t=await async function(){if(o.oauth){const t=new Date;t.setDate(t.getDate()-1);const a=t.toISOString().split("T")[0];return(await fetch(`${e}/scores/low?channel=${o.channel}&game=parachute&date=${a}`,{method:"GET"}).then(e=>e.json()))[0]}return null}();t&&t.score&&ComfyJS.Say(`/me The lowest score in the past 24 hours is ${t.score} by ${t.user}`)}if(("droptop"===r||"droptopscores"===r||"dropleaderboard"===r||"dropscores"===r)&&o.oauth){let t=await async function(){if(o.oauth){const t=new Date;t.setDate(t.getDate()-1);const a=t.toISOString().split("T")[0];return await fetch(`${e}/scores/high?channel=${o.channel}&game=parachute&date=${a}`,{method:"GET"}).then(e=>e.json())}return[]}();if(t&&t.length>0){let e=Array.from(new Set(t.map(e=>e.userId))).slice(0,10).map(e=>t.find(t=>t.userId===e));ComfyJS.Say(`/me Top players in the past 24 hours are ${e.map((e,t)=>`${t+1}. ${e.user} (${e.score})`).join(", ")}`)}else ComfyJS.Say("/me There are no scores recorded in the past 24 hours")}if("droprecent"===r&&o.oauth){let t=await async function(){if(o.oauth){return await fetch(`${e}/scores/recent?channel=${o.channel}&game=parachute`,{method:"GET"}).then(e=>e.json())}return[]}();if(t&&t.length>0){let e=Array.from(new Set(t.map(e=>e.userId))).slice(0,10).map(e=>t.find(t=>t.userId===e));ComfyJS.Say(`/me Latest scores are ${e.map((e,t)=>`${e.user} (${e.score})`).join(", ")}`)}else ComfyJS.Say("/me There are no recent scores")}let d=!1;if(o.command&&r===o.command&&(d=!0),o.command||"drop"!==r||(d=!0),p){if(d){f&&o.hideTilDrop&&(f=!1,O.forEach(e=>e.visible=!0),Array.isArray(_)?(_[I].visible=!0,setInterval(()=>{_[I].visible=!1,I=(I+1)%_.length,_[I].visible=!0},60)):_.visible=!0,U&&(U.visible=!0));const e=twemoji.parse(n,{assetType:"png"});!i.messageEmotes&&e.length>0?z(i.username,t,i.userColor||"#ffffff",n,a.parachutes[l(a.parachutes.length)],"",e[0].url,i):z(i.username,t,i.userColor||"#ffffff",n,a.parachutes[l(a.parachutes.length)],i.messageEmotes?Object.keys(i.messageEmotes)[0]:"","",i)}}else d&&o.oauth&&ComfyJS.Say("PixelParachute is disabled in this channel for violating the Terms of Service. To re-enable the game, please contact the PixelPlush team on Discord.")}function m(e,t,a,o,r){document.hidden}function g(e,t,a,o,r){if(!document.hidden&&p)for(let e=0;e<5;e++)C(t)}let x,b=null,$=368,v=0,S=0,_=null,U=null,I=0,w={},L=0,A="",M={},P={},O=[],T=[],E=0;function j(e,t,a,o,r,n=""){E++;let s=Math.min(Math.max(1,r),100);Unicorn.AddParticles("Splash_"+E,{blendMode:PIXI.BLEND_MODES.DEFAULT,shape:"cone",angle:-Math.PI/2,spread:Math.PI/2,startColor:e,endColor:t,intensity:s,minSpeed:.05,maxSpeed:.25,gravityX:0,gravityY:3.5,fadeOut:!0,decay:1,image:n||void 0},a,o),function(e,t=2e3){setTimeout(()=>{Unicorn.RemoveParticles(e)},t)}("Splash_"+E,150)}function k(e,t,o,r=""){a.target_boosh.forEach((a,o)=>{for(let a=0;a<l(5);a++){E++;let o=Unicorn.AddBacklay("boosh_"+E,"target_boosh"+a,e,t+10,{scale:{x:2,y:2}});o.zIndex=11,o.vX=l(50)-25,o.vY=-350+l(100),o.anchor.set(.5),T.push(o)}})}async function z(t,s,c="#ffffff",p,d,h="",y="",f){if(!w[t]){w[t]={};let g=null,x=null,$=null,v=tinycolor(c),S={};try{let a=await fetch(`${e}/accounts/twitch/design?username=${t}`).then(e=>e.json());a&&(S=a.style||{})}catch(e){console.log(e)}if(S.pet&&S.pet.id&&"pet_none"!==S.pet.id&&(a.pets||(a.pets={}),x=S.pet.id.replace("pet_",""),!a.pets[x])){a.pets[x]={path:S.pet.path,minIdle:S.pet.minIdle,maxIdle:S.pet.maxIdle};for(let e=0;e<10;e++){let t=S.pet.path+"_front";Unicorn.Load(t+e,`${r}/assets/pets/${x}/${t}/${t}${e+1}.png`)}}if(h){if(!M[h]){M[h]=!0;var u=`https://static-cdn.jtvnw.net/emoticons/v1/${h}/2.0`;return Unicorn.Load(`emote_${h}`,u),void setTimeout(()=>{delete w[t],z(t,s,c,p,d,h,y,f)},500)}g=Unicorn.AddObject("player_"+t,{type:"circle",scale:{x:1.2,y:1.2},animations:{front:{framerate:4/60,frames:[`emote_${h}`],loop:!0}},x:l(n),y:-100-l(50),z:100,radius:36}),g.endImage=`emote_${h}`,g.endScale=1.2}else if(y){if(!P[y])return P[y]=!0,Unicorn.Load(`emoji_${y}`,y),void setTimeout(()=>{delete w[t],z(t,s,c,p,d,h,y,f)},500);g=Unicorn.AddObject("player_"+t,{type:"circle",scale:{x:1,y:1},animations:{front:{framerate:4/60,frames:[`emoji_${y}`],loop:!0}},x:l(n),y:-100-l(50),z:100,radius:36}),g.endImage=`emoji_${y}`,g.endScale=1}else{if(!a.characters[p])if(S.character&&S.character.id){if(!a.characters[S.character.id]){a.characters[S.character.id]=S.character.path;for(let e=0;e<10;e++){let t=a.characters[S.character.id];Unicorn.Load(`${S.character.id}_${e}`,`${r}/assets/characters/${S.character.id}/${t}_front/${t}_front${e+1}.png`)}}p=S.character.id}else p=a.playable[Math.floor(a.playable.length*Math.random())];if(g=Unicorn.AddObject("player_"+t,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:4/60,frames:[...Array(10).keys()].map(e=>`${p}_${e}`),loop:!0}},x:l(n),y:-100-l(50),z:100,radius:36}),g.endImage=`${p}_0`,g.endScale=3,"boybear"===p||"girlbear"===p){var m=PIXI.utils.string2hex(v.brighten(50).toHexString());g.animations.front.tint=m}}if(x){let e={front:[]};for(let t=0;t<10;t++)Object.keys(e).forEach(o=>{e[o].push(a.pets[x].path+"_"+o+t)});$=Unicorn.AddObject("pet_"+t,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:4/60,frames:e.front,loop:!0}},x:-1e3,y:-1e3,z:200,radius:24,isStatic:!0}),$.isSensor=!0}let _=Unicorn.AddBacklay("para_"+t,d,{scale:{x:3,y:3},x:50,y:0,z:50});_.scale.x=0,_.scale.y=0,_.anchor.set(.5,.9);let U=Unicorn.AddText("name_"+t,s,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:c,lineJoin:"round",stroke:v.getLuminance()<.6?"#ffffff":"#000000",strokeThickness:6});U.anchor.set(.5);let I=Unicorn.AddText(t+"_points","",-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:"#ffd700",lineJoin:"round",stroke:"#000000",strokeThickness:6});I.anchor.set(.5);let L=null;x&&(L=Unicorn.AddBacklay("petpara_"+t,d,{scale:{x:1,y:1},x:50,y:0,z:150}),L.scale.x=0,L.scale.y=0,L.anchor.set(.5,.5)),g.restitution=1,g.friction=0,g.frictionStatic=0,g.frictionAir=0,g.torque=-5+l(10),g.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity("player_"+t,l(24)-12,0),w[t]={parachute:_,player:g,pet:$,petPara:L,petType:x,petOffset:30*Math.random()+(Math.random()>.5?-150:70),label:U,scoreLabel:I},f&&(w[t].userId=f.userId,w[t].name=f.displayName||f.username),Unicorn.PlaySound("sfx-parachute-drop",{volume:i}),b&&clearTimeout(b),b=setTimeout(()=>{location.reload()},parseInt(o.cooldown||"90000"))}}async function C(e){if(!o.droplets)return;E++;let t=null,r=0;r=e<100?0:e<1e3?1:e<5e3?2:e<1e4?3:e<1e5?4:5;let s=3;a.dropletSizes&&(s*=a.dropletSizes[r]);let i=a.droplets[r];Array.isArray(a.droplets[r])&&(i=a.droplets[r][l(a.droplets[r].length)]),t=Unicorn.AddObject("droplet_"+E,{type:"circle",sprite:i,scale:{x:s,y:s},x:l(n),y:-100-l(50),z:100,radius:r/5*4+20}),t.restitution=1,t.friction=.5*(5-r),t.frictionStatic=0,t.frictionAir=0,t.torque=-1+l(2),t.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity("droplet_"+E,l(24)-12,0),setTimeout(()=>{Unicorn.RemoveObject(t.label)},3e4)}function D(){if(PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,Unicorn.Load("map",`${r}/assets/${a.bg}.png`),!o.overlay){var e=Unicorn.AddBacklay("map","map",0,s-1080);e.scale.x=3,e.scale.y=3}if(Array.isArray(a.target)){a.target.map((e,t)=>Unicorn.Load("target"+t,`${r}/assets/${e}.png`))}else{Unicorn.Load("target",`${r}/assets/${a.target}.png`)}a.target_front&&Unicorn.Load("target_front",`${r}/assets/${a.target_front}.png`),a.target_boosh&&a.target_boosh.forEach((e,t)=>{Unicorn.Load("target_boosh"+t,`${r}/assets/${e}.png`)}),Unicorn.Load("star",`${r}/assets/icons/star.png`),x=Unicorn.AddOverlay("star","star",-1e3,-1e3,{scale:{x:3,y:3}}),x.anchor.set(.5),a.parachutes.forEach(e=>Unicorn.Load(e,`${r}/assets/${e}.png`)),Object.keys(a.characters).forEach(e=>{for(let t=0;t<10;t++){let o=a.characters[e];Unicorn.Load(`${e}_${t}`,`${r}/assets/characters/${e}/${o}_front/${o}_front${t+1}.png`)}}),a.clouds.forEach(e=>Unicorn.Load(e,`${r}/assets/${e}.png`)),a.droplets.forEach(e=>{Array.isArray(e)?e.forEach(e=>Unicorn.Load(e,`${r}/assets/${e}.png`)):Unicorn.Load(e,`${r}/assets/${e}.png`)}),a.target_sound&&Unicorn.Load("sfx-target-drop",`${r}/assets/${a.target_sound}`),Unicorn.Load("sfx-parachute-drop",`${r}/assets/${a.drop_sound}`),Unicorn.Load("sfx-parachute-flap",`${r}/assets/${a.parachute_sound}`),Unicorn.AddObject("WallLeft",{type:"rectangle",x:-200,y:0,width:400,height:2*s,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("WallRight",{type:"rectangle",x:n+200,y:0,width:400,height:2*s,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("WallBottom",{type:"rectangle",x:.5*n,y:s+100,width:n,height:200,isStatic:!0}).sprite.visible=!1,Matter.Events.on(physics,"beforeUpdate",(function(e){for(var t in w)w[t].player&&(w[t].player.position.y<.5*-s?w[t].player.velocity.y>10&&Matter.Body.setVelocity(w[t].player,{x:w[t].player.velocity.x,y:10}):w[t].player.position.y>300&&w[t].player.velocity.y>.5&&Matter.Body.setVelocity(w[t].player,{x:w[t].player.velocity.x,y:.5}))})),Matter.Events.on(physics,"afterUpdate",(function(e){for(var t in w)if(w[t].pet){let e=Math.min(3,Math.max(0,.3*(w[t].player.position.y-300)));w[t].petPara.scale.x=w[t].petPara.scale.y=e/2,w[t].pet.angle=w[t].player.angle,w[t].pet.position.x=Math.max(20,Math.min(n-20,w[t].player.position.x+w[t].petOffset)),w[t].pet.position.y=w[t].player.position.y+20,w[t].petPara.rotation=w[t].player.angle,w[t].petPara.position.x=w[t].pet.position.x,w[t].petPara.position.y=w[t].pet.position.y-30}}))}function B(e,t){for(var r in w)if(w[r].player)if(w[r].isLanded){let e=r===A?1:.3;w[r].end.alpha=w[r].label.alpha=e,w[r].pet&&(w[r].petEnd.alpha=e),w[r].scoreLabel.tint=w[r].label.tint=r===A?16777215:3355443,r===A?(w[r].end.zIndex=w[r].scoreLabel.zIndex=w[r].label.zIndex=9e3,w[r].pet&&(w[r].pet.zIndex=9001),w[r].label.position.x=w[r].player.position.x,w[r].label.position.y=w[r].player.position.y-80,w[r].scoreLabel.position.x=w[r].label.position.x+15,w[r].scoreLabel.position.y=w[r].label.position.y-30,w[r].label.style.fontSize=46,w[r].scoreLabel.style.fontSize=46,x.x=w[r].scoreLabel.x-w[r].scoreLabel.width/2-15,x.y=w[r].scoreLabel.y-5):(w[r].label.position.x=w[r].player.position.x,w[r].label.position.y=w[r].player.position.y-60,w[r].scoreLabel.position.y=w[r].label.position.y-30,w[r].scoreLabel.alpha=0,w[r].label.style.fontSize=40,w[r].scoreLabel.style.fontSize=40)}else{if(w[r].pet&&(w[r].pet.position.x=Math.max(20,Math.min(n-20,w[r].player.position.x+w[r].petOffset)),w[r].pet.position.y=w[r].player.position.y+20,w[r].petPara.position.x=w[r].pet.position.x,w[r].petPara.position.y=w[r].pet.position.y-30),w[r].player.position.y>s-46-50+(a.target_y_offset||0)){w[r].isLanded=!0,w[r].parachute.scale.x=w[r].parachute.scale.y=0,w[r].pet&&(w[r].petPara.scale.x=w[r].petPara.scale.y=0);let e=Unicorn.AddBacklay("end_"+r,w[r].player.endImage,w[r].player.position.x,w[r].player.position.y,{scale:{x:w[r].player.endScale,y:w[r].player.endScale}});if(w[r].player.animations&&(e.tint=w[r].player.animations.front.tint),e.anchor.set(.5),e.zIndex=20,w[r].player.isStatic=!0,w[r].score=100*Math.max(0,$/2-Math.abs(v-w[r].player.position.x))/($/2),e.alpha=w[r].score>0?1:.3,w[r].end=e,w[r].pet){let e=Unicorn.AddBacklay("petend_"+r,`${w[r].petType}_front0`,w[r].pet.position.x,w[r].pet.position.y,{scale:{x:3,y:3}});w[r].pet.animations&&(e.tint=w[r].pet.animations.front.tint),e.anchor.set(.5),e.zIndex=30,w[r].pet.isStatic=!0,e.alpha=w[r].score>0?1:.3,w[r].petEnd=e}if(w[r].score>0){if(a.target_particles&&j(a.target_particles[0],a.target_particles[1],w[r].player.position.x,w[r].player.position.y+40,10),a.target_boosh&&k(w[r].player.position.x,w[r].player.position.y+40),a.target_sound&&Unicorn.PlaySound("sfx-target-drop",{volume:i}),w[r].scoreLabel.x=w[r].label.position.x,w[r].scoreLabel.y=w[r].label.position.y-30,w[r].scoreLabel.text=w[r].score.toFixed(2),o.messageFormat){let e=o.messageFormat.replace("USERNAME",w[r].name).replace("POINTS",w[r].score.toFixed(2));setTimeout(()=>{ComfyJS.Say(e)},5e3)}r.startsWith("test_")||h(w[r].name,w[r].score.toFixed(2),w[r].userId,r)}w[r].score>L&&(L=w[r].score,A=r),w[r].label.alpha=w[r].score>0?1:.3,Unicorn.RemoveObject(w[r].player.label),Unicorn.RemoveBacklay("para_"+r),w[r].pet&&(Unicorn.RemoveObject(w[r].pet.label),Unicorn.RemoveBacklay("petpara_"+r))}else if(w[r].player.position.y>300){let t=Math.min(3,Math.max(0,.3*(w[r].player.position.y-300)));w[r].parachute.scale.x<=0&&t>0&&Unicorn.PlaySound("sfx-parachute-flap",{volume:i}),w[r].parachute.scale.x=w[r].parachute.scale.y=t,w[r].parachute.rotation=Math.sin(w[r].player.rotationOffset+e/1e3)*Math.PI/16,w[r].player.angle=Math.sin(w[r].player.rotationOffset+e/1e3)*Math.PI/16,w[r].parachute.position.x=w[r].player.position.x,w[r].parachute.position.y=w[r].player.position.y-10}else w[r].player.position.y<.5*-s||(w[r].parachute.scale.x=w[r].parachute.scale.y=0,w[r].pet&&(w[r].petPara.scale.x=w[r].petPara.scale.y=0));w[r].label.position.x=w[r].player.position.x,w[r].label.position.y=w[r].player.position.y-60}O.forEach((e,a)=>{e.x-=t*e.speed,e.x+e.width/2<=0&&(e.x=n+e.width/2,e.y=l(500),e.speed=.01+.1*Math.random(),e.zIndex=e.speed)}),T.forEach(e=>{(e.vY<0||e.y<s-20)&&(e.x+=t/1e3*e.vX,e.y+=t/1e3*e.vY,e.vY<20&&(e.vY+=t/1e3*200))})}