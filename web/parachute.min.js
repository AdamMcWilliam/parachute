let e="Pixel Parachute",t={},a={},o="",n=1920,r=1080,i=.5;function s(e){return Math.floor(Math.random()*Math.floor(e))}window.setupGame=function(s,l,c){e=s,t=l,a=c,o=t.path||"",a.clouds=void 0===a.clouds||null===a.clouds?!a.overlay:a.clouds,i=void 0===a.volume||null===a.volume?0:parseInt(a.volume)/100,n=Math.min(window.innerWidth,1920),r=Math.min(window.innerHeight,1080)},window.WebFontConfig={custom:{families:["Pixeltype"]},active(){!async function(){if(document.hidden)return void document.addEventListener("visibilitychange",()=>{location.reload()},!1);try{const e=(await fetch(`${o}/assets/shamelist.txt`).then(e=>e.text())).split(",").map(e=>e.trim().toLowerCase());a.channel&&e&&e.includes(a.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),c=!1)}catch(e){console.log(e)}Unicorn.Create("unicorn-display",{width:n,height:r,background:"transparent",init:z,update:C,channel:a.channel,username:a.oauth?a.channel:void 0,password:a.oauth,onCommand:h,onChat:f,screenWalls:!1,gravity:{x:0,y:1}}),ComfyJS.onCheer=u,ComfyJS.onConnected=async(e,o,i)=>{if(i){!function(){if(g=t.target_width||368,b=g/2+s(n-g),v=r-47+(t.target_offset||0),Array.isArray(t.target)){U=0,_=[];for(let e=0;e<t.target.length;e++){let t=Unicorn.AddBacklay("target"+e,"target"+e,b,v,{scale:{x:2,y:2}});t.zIndex=10,t.anchor.set(.5),t.visible=!1,_.push(t)}_[U].visible=!0,a.hideTilDrop||setInterval(()=>{_[U].visible=!1,U=(U+1)%_.length,_[U].visible=!0},60)}else _=Unicorn.AddBacklay("target","target",b,v,{scale:{x:2,y:2}}),_.zIndex=10,_.anchor.set(.5);t.target_front&&($=Unicorn.AddOverlay("target_front","target_front",b,v,{scale:{x:2,y:2}}),$.anchor.set(.5));if(a.clouds)for(let e=0;e<11;e++){d++;let e=t.clouds[s(t.clouds.length)],o=Unicorn.AddOverlay("cloud_"+d,e,s(n),s(500),{scale:{x:3,y:3}});o.alpha=a.overlay?.5:.9,o.anchor.set(.5),o.speed=.01+.1*Math.random(),o.zIndex=o.speed,A.push(o)}a.hideTilDrop&&(A.forEach(e=>e.visible=!1),Array.isArray(t.target)?_.forEach(e=>{e.visible=!1}):_.visible=!1,$.visible=!1)}();let e=await p();0!==e&&(l=e.session,setInterval(()=>{p()},6e4))}}}()}},function(){const e=document.createElement("script");e.src=`${"https:"===document.location.protocol?"https":"http"}://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js`,e.type="text/javascript",e.async="true";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();var l="",c=!0;async function p(){let t=Object.keys(S).length;return fetch("https://api.pixelplush.dev/v1/analytics/heartbeat",{method:"POST",body:JSON.stringify({session:l,game:"parachute",theme:e,channel:a.channel,players:Object.keys(S),count:t})}).then(e=>e.json())}let d=0,y=!0;function h(e,o,n,r,i){if(document.hidden)return;if(!r.broadcaster&&!r.mod||"resetparachute"!==o&&"resetdrop"!==o||location.reload(),(r.broadcaster||r.mod)&&"testdrop"===o)for(var l=0;l<50;l++)d++,k("test"+d,"test_"+d,i.userColor||"#ffffff",Object.keys(t.characters)[s(Object.keys(t.characters).length)],t.parachutes[s(t.parachutes.length)]);if((r.broadcaster||r.mod)&&"droplet"===o){let e=parseInt(n||Math.pow(10,s(6)));for(let t=0;t<5;t++)T(e)}let p=!1;if(a.command&&o===a.command&&(p=!0),a.command||"drop"!==o||(p=!0),c){if(p){y&&a.hideTilDrop&&(y=!1,A.forEach(e=>e.visible=!0),Array.isArray(_)?(_[U].visible=!0,setInterval(()=>{_[U].visible=!1,U=(U+1)%_.length,_[U].visible=!0},60)):_.visible=!0,$&&($.visible=!0));const o=twemoji.parse(n,{assetType:"png"});!i.messageEmotes&&o.length>0?k(i.username,e,i.userColor||"#ffffff",n,t.parachutes[s(t.parachutes.length)],"",o[0].url):k(i.username,e,i.userColor||"#ffffff",n,t.parachutes[s(t.parachutes.length)],i.messageEmotes?Object.keys(i.messageEmotes)[0]:"")}}else p&&a.oauth&&ComfyJS.Say("PixelParachute is disabled in this channel for violating the Terms of Service. To re-enable the game, please contact the PixelPlush team on Discord.")}function f(e,t,a,o,n){document.hidden}function u(e,t,a,o,n){if(!document.hidden&&c)for(let e=0;e<5;e++)T(t)}let m,x=null,g=368,b=0,v=0,_=null,$=null,U=0,S={},L=0,M="",I={},P={},A=[],O=[],E=0;function j(e,t,a,o,n,r=""){E++;let i=Math.min(Math.max(1,n),100);Unicorn.AddParticles("Splash_"+E,{blendMode:PIXI.BLEND_MODES.DEFAULT,shape:"cone",angle:-Math.PI/2,spread:Math.PI/2,startColor:e,endColor:t,intensity:i,minSpeed:.05,maxSpeed:.25,gravityX:0,gravityY:3.5,fadeOut:!0,decay:1,image:r||void 0},a,o),function(e,t=2e3){setTimeout(()=>{Unicorn.RemoveParticles(e)},t)}("Splash_"+E,150)}function w(e,a,o,n=""){t.target_boosh.forEach((t,o)=>{for(let t=0;t<s(5);t++){E++;let o=Unicorn.AddBacklay("boosh_"+E,"target_boosh"+t,e,a+10,{scale:{x:2,y:2}});o.zIndex=11,o.vX=s(50)-25,o.vY=-350+s(100),o.anchor.set(.5),O.push(o)}})}async function k(e,r,l="#ffffff",c,p,d="",y=""){if(!S[e]){S[e]={};let u=null,m=null,g=null,b=tinycolor(l),v={};try{let t=await fetch(`https://api.pixelplush.dev/v1/accounts/twitch/design?username=${e}`).then(e=>e.json());t&&(v=t.style||{})}catch(e){console.log(e)}if(v.pet&&v.pet.id&&"pet_none"!==v.pet.id&&(t.pets||(t.pets={}),m=v.pet.id.replace("pet_",""),!t.pets[m])){t.pets[m]={path:v.pet.path,minIdle:v.pet.minIdle,maxIdle:v.pet.maxIdle};for(let e=0;e<10;e++){let t=v.pet.path+"_front";Unicorn.Load(t+e,`${o}/assets/pets/${m}/${t}/${t}${e+1}.png`)}}if(d){if(!I[d]){I[d]=!0;var h=`https://static-cdn.jtvnw.net/emoticons/v1/${d}/2.0`;return Unicorn.Load(`emote_${d}`,h),void setTimeout(()=>{delete S[e],k(e,r,l,c,p,d,y)},500)}u=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:1.2,y:1.2},animations:{front:{framerate:4/60,frames:[`emote_${d}`],loop:!0}},x:s(n),y:-100-s(50),z:100,radius:36}),u.endImage=`emote_${d}`,u.endScale=1.2}else if(y){if(!P[y])return P[y]=!0,Unicorn.Load(`emoji_${y}`,y),void setTimeout(()=>{delete S[e],k(e,r,l,c,p,d,y)},500);u=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:1,y:1},animations:{front:{framerate:4/60,frames:[`emoji_${y}`],loop:!0}},x:s(n),y:-100-s(50),z:100,radius:36}),u.endImage=`emoji_${y}`,u.endScale=1}else{if(!t.characters[c])if(v.character&&v.character.id){if(!t.characters[v.character.id]){t.characters[v.character.id]=v.character.path;for(let e=0;e<10;e++){let a=t.characters[v.character.id];Unicorn.Load(`${v.character.id}_${e}`,`${o}/assets/characters/${v.character.id}/${a}_front/${a}_front${e+1}.png`)}}c=v.character.id}else c=t.playable[Math.floor(t.playable.length*Math.random())];if(u=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:4/60,frames:[...Array(10).keys()].map(e=>`${c}_${e}`),loop:!0}},x:s(n),y:-100-s(50),z:100,radius:36}),u.endImage=`${c}_0`,u.endScale=3,"boybear"===c||"girlbear"===c){var f=PIXI.utils.string2hex(b.brighten(50).toHexString());u.animations.front.tint=f}}if(m){let a={front:[]};for(let e=0;e<10;e++)Object.keys(a).forEach(o=>{a[o].push(t.pets[m].path+"_"+o+e)});g=Unicorn.AddObject("pet_"+e,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:4/60,frames:a.front,loop:!0}},x:-1e3,y:-1e3,z:200,radius:24,isStatic:!0}),g.isSensor=!0}let _=Unicorn.AddBacklay("para_"+e,p,{scale:{x:3,y:3},x:50,y:0,z:50});_.scale.x=0,_.scale.y=0,_.anchor.set(.5,.9);let $=Unicorn.AddText("name_"+e,r,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:l,lineJoin:"round",stroke:b.getLuminance()<.6?"#ffffff":"#000000",strokeThickness:6});$.anchor.set(.5);let U=Unicorn.AddText(e+"_points","",-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:"#ffd700",lineJoin:"round",stroke:"#000000",strokeThickness:6});U.anchor.set(.5);let L=null;m&&(L=Unicorn.AddBacklay("petpara_"+e,p,{scale:{x:1,y:1},x:50,y:0,z:150}),L.scale.x=0,L.scale.y=0,L.anchor.set(.5,.5)),u.restitution=1,u.friction=0,u.frictionStatic=0,u.frictionAir=0,u.torque=-5+s(10),u.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity("player_"+e,s(24)-12,0),S[e]={parachute:_,player:u,pet:g,petPara:L,petType:m,petOffset:30*Math.random()+(Math.random()>.5?-150:70),label:$,scoreLabel:U},Unicorn.PlaySound("sfx-parachute-drop",{volume:i}),x&&clearTimeout(x),x=setTimeout(()=>{location.reload()},parseInt(a.cooldown||"90000"))}}async function T(e){if(!a.droplets)return;E++;let o=null,r=0;r=e<100?0:e<1e3?1:e<5e3?2:e<1e4?3:e<1e5?4:5,o=Unicorn.AddObject("droplet_"+E,{type:"circle",sprite:t.droplets[r],scale:{x:3,y:3},x:s(n),y:-100-s(50),z:100,radius:r/5*4+20}),o.restitution=1,o.friction=.5*(5-r),o.frictionStatic=0,o.frictionAir=0,o.torque=-5+s(10),o.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity("droplet_"+E,s(24)-12,0),setTimeout(()=>{Unicorn.RemoveObject(o.label)},3e4)}function z(){if(PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,Unicorn.Load("map",`${o}/assets/${t.bg}.png`),!a.overlay){var e=Unicorn.AddBacklay("map","map",0,r-1080);e.scale.x=3,e.scale.y=3}if(Array.isArray(t.target)){t.target.map((e,t)=>Unicorn.Load("target"+t,`${o}/assets/${e}.png`))}else{Unicorn.Load("target",`${o}/assets/${t.target}.png`)}t.target_front&&Unicorn.Load("target_front",`${o}/assets/${t.target_front}.png`),t.target_boosh&&t.target_boosh.forEach((e,t)=>{Unicorn.Load("target_boosh"+t,`${o}/assets/${e}.png`)}),Unicorn.Load("star",`${o}/assets/icons/star.png`),m=Unicorn.AddOverlay("star","star",-1e3,-1e3,{scale:{x:3,y:3}}),m.anchor.set(.5),t.parachutes.forEach(e=>Unicorn.Load(e,`${o}/assets/${e}.png`)),Object.keys(t.characters).forEach(e=>{for(let a=0;a<10;a++){let n=t.characters[e];Unicorn.Load(`${e}_${a}`,`${o}/assets/characters/${e}/${n}_front/${n}_front${a+1}.png`)}}),t.clouds.forEach(e=>Unicorn.Load(e,`${o}/assets/${e}.png`)),t.droplets.forEach(e=>Unicorn.Load(e,`${o}/assets/${e}.png`)),t.target_sound&&Unicorn.Load("sfx-target-drop",`${o}/assets/${t.target_sound}`),Unicorn.Load("sfx-parachute-drop",`${o}/assets/${t.drop_sound}`),Unicorn.Load("sfx-parachute-flap",`${o}/assets/${t.parachute_sound}`),Unicorn.AddObject("WallLeft",{type:"rectangle",x:-200,y:0,width:400,height:2*r,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("WallRight",{type:"rectangle",x:n+200,y:0,width:400,height:2*r,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("WallBottom",{type:"rectangle",x:.5*n,y:r+100,width:n,height:200,isStatic:!0}).sprite.visible=!1,Matter.Events.on(physics,"beforeUpdate",(function(e){for(var t in S)S[t].player&&(S[t].player.position.y<.5*-r?S[t].player.velocity.y>10&&Matter.Body.setVelocity(S[t].player,{x:S[t].player.velocity.x,y:10}):S[t].player.position.y>300&&S[t].player.velocity.y>.5&&Matter.Body.setVelocity(S[t].player,{x:S[t].player.velocity.x,y:.5}))})),Matter.Events.on(physics,"afterUpdate",(function(e){for(var t in S)if(S[t].pet){let e=Math.min(3,Math.max(0,.3*(S[t].player.position.y-300)));S[t].petPara.scale.x=S[t].petPara.scale.y=e/2,S[t].pet.angle=S[t].player.angle,S[t].pet.position.x=Math.max(20,Math.min(n-20,S[t].player.position.x+S[t].petOffset)),S[t].pet.position.y=S[t].player.position.y+20,S[t].petPara.rotation=S[t].player.angle,S[t].petPara.position.x=S[t].pet.position.x,S[t].petPara.position.y=S[t].pet.position.y-30}}))}function C(e,o){for(var l in S)if(S[l].player)if(S[l].isLanded){let e=l===M?1:.3;S[l].end.alpha=S[l].label.alpha=e,S[l].pet&&(S[l].petEnd.alpha=e),S[l].scoreLabel.tint=S[l].label.tint=l===M?16777215:3355443,l===M?(S[l].end.zIndex=S[l].scoreLabel.zIndex=S[l].label.zIndex=9e3,S[l].pet&&(S[l].pet.zIndex=9001),S[l].label.position.x=S[l].player.position.x,S[l].label.position.y=S[l].player.position.y-80,S[l].scoreLabel.position.x=S[l].label.position.x+15,S[l].scoreLabel.position.y=S[l].label.position.y-30,S[l].label.style.fontSize=46,S[l].scoreLabel.style.fontSize=46,m.x=S[l].scoreLabel.x-S[l].scoreLabel.width/2-15,m.y=S[l].scoreLabel.y-5):(S[l].label.position.x=S[l].player.position.x,S[l].label.position.y=S[l].player.position.y-60,S[l].scoreLabel.position.y=S[l].label.position.y-30,S[l].scoreLabel.alpha=0,S[l].label.style.fontSize=40,S[l].scoreLabel.style.fontSize=40)}else{if(S[l].pet&&(S[l].pet.position.x=Math.max(20,Math.min(n-20,S[l].player.position.x+S[l].petOffset)),S[l].pet.position.y=S[l].player.position.y+20,S[l].petPara.position.x=S[l].pet.position.x,S[l].petPara.position.y=S[l].pet.position.y-30),S[l].player.position.y>r-46-50+(t.target_y_offset||0)){S[l].isLanded=!0,S[l].parachute.scale.x=S[l].parachute.scale.y=0,S[l].pet&&(S[l].petPara.scale.x=S[l].petPara.scale.y=0);let e=Unicorn.AddBacklay("end_"+l,S[l].player.endImage,S[l].player.position.x,S[l].player.position.y,{scale:{x:S[l].player.endScale,y:S[l].player.endScale}});if(S[l].player.animations&&(e.tint=S[l].player.animations.front.tint),e.anchor.set(.5),e.zIndex=20,S[l].player.isStatic=!0,S[l].score=100*Math.max(0,g/2-Math.abs(b-S[l].player.position.x))/(g/2),e.alpha=S[l].score>0?1:.3,S[l].end=e,S[l].pet){let e=Unicorn.AddBacklay("petend_"+l,`${S[l].petType}_front0`,S[l].pet.position.x,S[l].pet.position.y,{scale:{x:3,y:3}});S[l].pet.animations&&(e.tint=S[l].pet.animations.front.tint),e.anchor.set(.5),e.zIndex=30,S[l].pet.isStatic=!0,e.alpha=S[l].score>0?1:.3,S[l].petEnd=e}if(S[l].score>0&&(t.target_particles&&j("#74cbfb","#50b0e5",S[l].player.position.x,S[l].player.position.y+40,10),t.target_boosh&&w(S[l].player.position.x,S[l].player.position.y+40),t.target_sound&&Unicorn.PlaySound("sfx-target-drop",{volume:i}),S[l].scoreLabel.x=S[l].label.position.x,S[l].scoreLabel.y=S[l].label.position.y-30,S[l].scoreLabel.text=S[l].score.toFixed(2),a.messageFormat)){let e=a.messageFormat.replace("USERNAME",l).replace("POINTS",S[l].score.toFixed(2));setTimeout(()=>{ComfyJS.Say(e)},5e3)}S[l].score>L&&(L=S[l].score,M=l),S[l].label.alpha=S[l].score>0?1:.3,Unicorn.RemoveObject(S[l].player.label),Unicorn.RemoveBacklay("para_"+l),S[l].pet&&(Unicorn.RemoveObject(S[l].pet.label),Unicorn.RemoveBacklay("petpara_"+l))}else if(S[l].player.position.y>300){let t=Math.min(3,Math.max(0,.3*(S[l].player.position.y-300)));S[l].parachute.scale.x<=0&&t>0&&Unicorn.PlaySound("sfx-parachute-flap",{volume:i}),S[l].parachute.scale.x=S[l].parachute.scale.y=t,S[l].parachute.rotation=Math.sin(S[l].player.rotationOffset+e/1e3)*Math.PI/16,S[l].player.angle=Math.sin(S[l].player.rotationOffset+e/1e3)*Math.PI/16,S[l].parachute.position.x=S[l].player.position.x,S[l].parachute.position.y=S[l].player.position.y-10}else S[l].player.position.y<.5*-r||(S[l].parachute.scale.x=S[l].parachute.scale.y=0,S[l].pet&&(S[l].petPara.scale.x=S[l].petPara.scale.y=0));S[l].label.position.x=S[l].player.position.x,S[l].label.position.y=S[l].player.position.y-60}A.forEach((e,t)=>{e.x-=o*e.speed,e.x+e.width/2<=0&&(e.x=n+e.width/2,e.y=s(500),e.speed=.01+.1*Math.random(),e.zIndex=e.speed)}),O.forEach(e=>{(e.vY<0||e.y<r-20)&&(e.x+=o/1e3*e.vX,e.y+=o/1e3*e.vY,e.vY<20&&(e.vY+=o/1e3*200))})}